@startuml
title "OneByOneVideoCollector Sequence Diagram (Clarity on Fetch & Exception)"

actor "Caller" as caller
participant "collector: OneByOneVideoCollector" as collector
participant "finder: VideoFinder" as finder
participant "api: YoutubeDataApiCaller" as api
participant "channelCollector: OneByOneChannelCollector" as channelCollector
participant "creator: VideoCreator" as creator

caller -> collector : collect(videoYoutubeIds)
activate collector

collector -> finder : findMissingVideoYoutubeIds(videoYoutubeIds)
activate finder
finder --> collector : missingVideoYoutubeIds
deactivate finder

note right of collector
    Fetches video details one by one
    for each missing video ID.
end note
loop for each videoYoutubeId in missingVideoYoutubeIds
    collector -> api : fetchVideos(List.of(videoYoutubeId))
    activate api
    api --> collector : videoListResponse
    deactivate api
end

collector -> channelCollector : collect(channelYoutubeIds)
activate channelCollector
channelCollector --> collector
deactivate channelCollector

loop for each videoResponse
    group try [Create Video Record]
        collector -> creator : create(videoId, channelId, title, thumbnailUrl)
        activate creator
        creator --> collector
        deactivate creator
    else catch [ChannelNotFoundException]
        note over collector : Log exception and continue loop
    end
end

collector --> caller : storedCount
deactivate collector

@enduml